<!DOCTYPE html>
<html>
   <head>
      <title>Leaflet sample</title>

      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="crossorigin=""/>

      <link rel="stylesheet" href="style/main.css">
      
<!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" crossorigin="anonymous"></script>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
   <script src="sezioni.js"></script>
   </head>

   <body>
    <!---
    <div class="switch-field" style="margin-bottom: 15px">
        <input type="radio" id="radio-three" name="switch-two" value="tot" checked/>
        <label for="radio-three">Tutte le strutture ricettive</label>
        <input type="radio" id="radio-four" name="switch-two" value="loc" />
        <label for="radio-four">Solo locazioni turistiche</label>
    </div> --->
      <div id = "mappa" style = "width: 900px; height: 580px"></div>
   </body>
   
   <script type="text/javascript">
   
// Creating map options

   	var mapOptions = {
   		center: [45.4386567,12.3355089],
        zoom: 13,
        }
         
// Creating a map object
    var map = new L.map('mappa', mapOptions);
         
// Creating a Layer object
  var layer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>', subdomains: 'abcd', maxZoom: 19});    
         
  map.addLayer(layer);

// Declare geojson
 var locazioni ;
 var tutto; 

// Style upcoming GeoJSON
function getColor(d) {
   return d > 199 ? '#a50f15' :
          d > 149 ? '#de2d26' :
          d > 99 ? '#fb6a4a' :
          d > 49 ? '#fcae91':
          d > 0.5 ? '#fee5d9':
          d = 0 ? '#ffffff':
          d < -199 ? '#006d2c':
          d < -149 ? '#31a354':
          d < -99 ? '#74c476':
          d < -49 ? '#bae4b3':
          d < -0.5 ? '#edf8e9':
          
                      '#ffffff';
}

function styleLOC(feature) {
    return {
        fillColor: getColor(feature.properties.differenza_percentuale_locazioni),
        weight: 0.3,
        opacity: 1,
        color: 'white',
        fillOpacity: 0.7
    };
}

function styleTOT(feature) {
    return {
        fillColor: getColor(feature.properties.differenza_percentuale),
        weight: 0.3,
        opacity: 1,
        color: 'white',
        fillOpacity: 0.7
    };
}

// Add GEOJSON

locazioni = L.geoJson(sezioni, {style: styleLOC, onEachFeature: onEachFeature}).addTo(map);
tutto = L.geoJson(sezioni, {style: styleTOT, onEachFeature: onEachFeature})

var basemapsObj = { 'solo locazioni turistiche':locazioni , 'tutte le strutture ricettive': tutto };

// Add listeners

function highlightFeature(e) {
    var layer = e.target;

    layer.setStyle({
        weight: 1,
        color: 'black',
        dashArray: '',
        fillOpacity: 0.5,
    });

    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }
}

function resetHighlight(e) {
  var layer = e.target;

    layer.setStyle({
        weight: 0.3,
        color: 'white',
        dashArray: '',
        fillOpacity: 0.7,
    });

    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }

}

function zoomToFeature(e) {
    map.fitBounds(e.target.getBounds());
}

function onEachFeature(feature, layer) {
    layer.on({
      mouseover: highlightFeature,
      mouseout: resetHighlight,
      click: zoomToFeature,
});
layer.bindTooltip("<p style='text-align: center;'><span style='font-size:1.1em; font-weight: 600'>Isolato " + feature.properties.codice_isolato + "</span><br>" + 
  "<span style='font-size:0.9em; text-align: center; font-weight: 200'>" + feature.properties.nome_localita + " (" + feature.properties.nome_quartiere + ")</span></p>" + 
  "<b>Popolazione</b>: " + feature.properties.popolazione+ "<br>" + 
  "<b>Posti letto</b>: " + feature.properties.totale_letti + " (di cui " + feature.properties.locazione_turistica_letti + " in <b>locazioni turistiche</b>)<br>" + 
  "<b>Strutture ricettive </b>: " + feature.properties.totale_strutture + " (di cui " + feature.properties.locazione_turistica_strutture + " <b>locazioni turistiche</b>)<br><br>" +  
  "<b>Differenze posti letto locazioni turistiche / popolazione</b>: " + feature.properties.differenza_locazioni + " ( " + feature.properties.differenza_percentuale_locazioni + "%)<br>"+
  "<b>Differenze posti letto / popolazione</b>: " + feature.properties.differenza + " ( " + feature.properties.differenza_percentuale + "%)" 

  );
    }  

L.control.layers(basemapsObj).addTo(map);

// Add control

var info = L.control();

info.onAdd = function (map) {
    this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    return this._div;
};

// method that we will use to update the control based on feature properties passed
info.update = function (props) {
};
// Add legend

var legend = L.control({position: 'topright'});

legend.onAdd = function (map) {

    var div = L.DomUtil.create('div', 'info legend'),
        grades = [-200,-150,-100,-50, -1, 0, 1,  50, 100, 150, 200],
        labels = [];

    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getColor(grades[i]) + '"></i> ' +
            grades[i] + '% <br>';
    }

    return div;
};

legend.addTo(map);


// Reset zoom control

var home = {
  lat: 45.4386567,
  lng: 12.3355089,
  zoom: 13
}; 

    // make a bar with the buttons
var zoomBar = L.easyBar([
  L.easyButton( 'fa-home fa-lg', function(control, map){map.setView([home.lat, home.lng], home.zoom);}),
     ]);

    // add it to the map
    zoomBar.addTo(map);

   </script>
</html>